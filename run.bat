@echo off
SETLOCAL EnableDelayedExpansion

:: Extract the contents of Win_10_EXP.zip to the script's directory
powershell -command "Expand-Archive -LiteralPath '%~dp0Win_10_EXP.zip' -DestinationPath '%~dp0' -Force"

:: Create directories
md C:\temp 2>nul
md C:\temp\testcase 2>nul

:: Copy files from the extracted contents to the testcase directory
copy /Y "%~dp0PNLPE.dll" C:\temp\testcase
copy /Y "%~dp0vlib.dll" C:\temp\testcase
copy /Y "%~dp0xconsole.exe" C:\temp\testcase

:: Check if copy was successful
IF !ERRORLEVEL! NEQ 0 (
    echo Failure in copying files.
    exit /b !ERRORLEVEL!
) ELSE (
    echo Success in copying files.
)

:: Ask user to run PNLPE.dll
set /p runDLL="Do you want to run PNLPE.dll now? (Y/N): "
if /I "!runDLL!"=="Y" (
    :: Attempt to run PNLPE.dll as executable
    start "" C:\temp\testcase\PNLPE.dll
) ELSE (
    echo Exiting script.
)

ENDLOCAL
